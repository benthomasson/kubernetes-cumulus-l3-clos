!
{# for all the bgp managed ports, enable IPv6 #}
{% for iface in bgp_managed_ports %}
interface {{iface}} vrf k8s
  no ipv6 nd suppress-ra
  ipv6 nd ra-interval 3
{% endfor %}

router bgp {{ bgp_asn }} vrf k8s
  no bgp default ipv4-unicast
  bgp bestpath compare-routerid
  bgp default show-hostname
  bgp router-id {{ loopback_ip }}
  {% if svi_ip is defined %}
  network {{ svi_ip }}
  {% endif %}
  network {{ loopback_ip }}/32
  maximum-paths 64
  bgp bestpath as-path multipath-relax
  neighbor fabric peer-group
  neighbor fabric description Internal Fabric network
  neighbor fabric advertisement-interval 0
  neighbor fabric timers 1 3
  neighbor fabric timers connect 3
  neighbor fabric remote-as external
  neighbor fabric capability extended-nexthop
  neighbor k8s_host peer-group
  neighbor k8s_host description Calico router reflector
  neighbor k8s_host route-reflector-client
  neighbor k8s_host next-hop-self
  neighbor k8s_host remote-as {{ bgp_asn }}
{% for iface in bgp_managed_ports %}
  neighbor {{iface}} interface peer-group fabric
{% endfor %}
{% for k8s_ip in k8s_ips %}
  neighbor {{ k8s_ip }}  peer-group k8s_host
{% endfor %}
  address-family ipv4 unicast
     neighbor fabric activate
  exit-address-family
